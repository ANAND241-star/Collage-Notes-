<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>NoteVault â€” College Notes</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;900&family=DM+Sans:wght@300;400;500;600&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet"/>
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0;}
:root{
  --bg:#080B14;--bg2:#0C1020;--panel:#0F1525;--card:#141928;--card2:#1A2035;--border:#1E2640;
  --accent:#6C63FF;--accent2:#FF6584;--accent3:#43E8D8;--gold:#FFD166;--text:#E8EBF8;
  --sub:#5A6282;--muted:#2E3554;--success:#06D6A0;--danger:#FF6B6B;--warn:#FFD166;
  --shadow:rgba(0,0,0,0.5);--font-display:'Playfair Display',serif;
  --font-body:'DM Sans',sans-serif;--font-mono:'JetBrains Mono',monospace;
}
[data-theme="light"]{
  --bg:#F4F6FF;--bg2:#ECEFFE;--panel:#E5E9FA;--card:#FFFFFF;--card2:#EEF1FF;--border:#C8D0EE;
  --accent:#5B52E8;--accent2:#E84F6B;--accent3:#0EBAAA;--gold:#C9920A;--text:#181C38;
  --sub:#6870A0;--muted:#C5CCED;--success:#047A5C;--danger:#C94040;--warn:#A86800;--shadow:rgba(0,0,0,0.1);
}
html,body,#root{height:100%;width:100%;background:var(--bg);color:var(--text);font-family:var(--font-body);overflow:hidden;transition:background .3s,color .3s;}
::-webkit-scrollbar{width:4px;}::-webkit-scrollbar-thumb{background:var(--border);border-radius:2px;}::-webkit-scrollbar-thumb:hover{background:var(--accent);}
@keyframes fadeUp{from{opacity:0;transform:translateY(18px)}to{opacity:1;transform:translateY(0)}}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}
@keyframes slideIn{from{opacity:0;transform:translateX(-22px)}to{opacity:1;transform:translateX(0)}}
@keyframes popIn{from{opacity:0;transform:scale(0.9)}to{opacity:1;transform:scale(1)}}
@keyframes toastIn{from{opacity:0;transform:translateX(110px)}to{opacity:1;transform:translateX(0)}}
@keyframes toastOut{from{opacity:1;transform:translateX(0)}to{opacity:0;transform:translateX(110px)}}
@keyframes savePulse{0%{box-shadow:0 0 0 0 rgba(108,99,255,.6)}70%{box-shadow:0 0 0 10px rgba(108,99,255,0)}100%{box-shadow:0 0 0 0 rgba(108,99,255,0)}}
@keyframes autosaveDot{0%,100%{opacity:1;transform:scale(1)}50%{opacity:.3;transform:scale(.6)}}
@keyframes logoPulse{0%,100%{filter:drop-shadow(0 0 6px var(--accent))}50%{filter:drop-shadow(0 0 16px var(--accent))}}
@keyframes dropIn{from{opacity:0;transform:translateY(-8px) scale(.97)}to{opacity:1;transform:translateY(0) scale(1)}}
@keyframes spin{to{transform:rotate(360deg)}}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.5}}

/* AUTH */
.auth-screen{display:flex;align-items:center;justify-content:center;height:100vh;background:var(--bg);}
.auth-box{background:var(--card);border:1px solid var(--border);border-radius:20px;padding:44px 48px;width:380px;text-align:center;animation:popIn .4s cubic-bezier(.34,1.56,.64,1);}
.auth-title{font-family:var(--font-display);font-size:1.8rem;margin:14px 0 4px;color:var(--text);}
.auth-sub{color:var(--sub);font-size:.82rem;margin-bottom:26px;}
.auth-input{width:100%;padding:10px 13px;border-radius:9px;border:1px solid var(--border);background:var(--bg2);color:var(--text);font-size:.85rem;outline:none;margin-bottom:10px;font-family:var(--font-body);transition:border-color .2s;}
.auth-input:focus{border-color:var(--accent);}
.auth-btn{width:100%;padding:11px;border-radius:10px;border:none;background:var(--accent);color:#fff;font-weight:700;font-size:.9rem;cursor:pointer;font-family:var(--font-body);margin-top:4px;transition:opacity .2s,transform .1s;}
.auth-btn:hover{opacity:.9;transform:scale(1.02);}
.auth-btn:disabled{opacity:.5;cursor:not-allowed;}
.auth-switch{margin-top:16px;font-size:.78rem;color:var(--sub);}
.auth-switch span{color:var(--accent);cursor:pointer;font-weight:600;}
.auth-error{background:rgba(255,107,107,.12);border:1px solid var(--danger);border-radius:8px;padding:8px 12px;font-size:.8rem;color:var(--danger);margin-bottom:12px;text-align:left;}

/* APP */
.app{display:flex;flex-direction:column;height:100vh;}
.topbar{display:flex;align-items:center;gap:12px;padding:0 16px;height:56px;background:var(--bg2);border-bottom:1px solid var(--border);flex-shrink:0;z-index:200;}
.topbar-logo{display:flex;align-items:center;gap:9px;cursor:pointer;}
.logo-icon{width:34px;height:34px;flex-shrink:0;animation:logoPulse 3s ease-in-out infinite;}
.logo-text-wrap{display:flex;flex-direction:column;line-height:1;}
.logo-title{font-size:1.05rem;font-weight:900;letter-spacing:-.5px;color:var(--text);font-family:var(--font-display);}
.logo-sub{font-size:.52rem;font-weight:600;letter-spacing:2.5px;text-transform:uppercase;color:var(--sub);margin-top:1px;}
.beta{font-size:.54rem;font-weight:700;background:var(--accent);color:#fff;padding:2px 5px;border-radius:4px;letter-spacing:1px;text-transform:uppercase;align-self:flex-start;margin-left:2px;}
.nav-tabs{display:flex;gap:2px;background:var(--card);border:1px solid var(--border);border-radius:10px;padding:3px;}
.nav-tab{padding:5px 14px;border-radius:7px;font-size:.78rem;font-weight:600;cursor:pointer;border:none;background:transparent;color:var(--sub);transition:all .2s;display:flex;align-items:center;gap:5px;}
.nav-tab:hover{color:var(--text);background:var(--card2);}
.nav-tab.active{background:var(--accent);color:#fff;box-shadow:0 2px 10px rgba(108,99,255,.4);}
.search-wrap{display:flex;align-items:center;gap:7px;flex:1;max-width:260px;background:var(--card);border:1px solid var(--border);border-radius:8px;padding:0 11px;transition:border-color .2s;}
.search-wrap:focus-within{border-color:var(--accent);}
.search-wrap input{flex:1;background:none;border:none;outline:none;color:var(--text);font-size:.83rem;padding:7px 0;}
.search-wrap input::placeholder{color:var(--sub);}
.autosave-indicator{display:flex;align-items:center;gap:5px;font-size:.7rem;color:var(--sub);font-family:var(--font-mono);}
.autosave-dot{width:7px;height:7px;border-radius:50%;background:var(--success);animation:autosaveDot 1.5s ease infinite;}
.autosave-dot.saving{background:var(--gold);}
.autosave-dot.idle{background:var(--sub);animation:none;}
.topbar-right{margin-left:auto;display:flex;align-items:center;gap:8px;}
.clock{font-family:var(--font-mono);font-size:.7rem;color:var(--sub);}
.stats-pill{background:var(--card);border:1px solid var(--border);padding:4px 9px;border-radius:20px;font-size:.68rem;color:var(--accent);font-weight:600;}
.theme-toggle{display:flex;align-items:center;gap:5px;background:var(--card);border:1px solid var(--border);border-radius:20px;padding:4px 10px;cursor:pointer;font-size:.73rem;font-weight:600;color:var(--text);transition:all .2s;white-space:nowrap;}
.theme-toggle:hover{border-color:var(--accent);}
.toggle-track{width:30px;height:16px;border-radius:20px;background:var(--muted);position:relative;transition:background .3s;flex-shrink:0;}
[data-theme="light"] .toggle-track{background:var(--accent);}
.toggle-thumb{width:12px;height:12px;border-radius:50%;background:#fff;position:absolute;top:2px;left:2px;transition:transform .3s cubic-bezier(.34,1.56,.64,1);box-shadow:0 1px 4px rgba(0,0,0,.3);}
[data-theme="light"] .toggle-thumb{transform:translateX(14px);}
.btn-logout{display:flex;align-items:center;gap:4px;background:rgba(255,107,107,.1);border:1px solid rgba(255,107,107,.3);border-radius:7px;padding:5px 9px;cursor:pointer;font-size:.72rem;font-weight:600;color:var(--danger);transition:all .15s;}
.btn-logout:hover{background:rgba(255,107,107,.2);}
.user-pill{display:flex;align-items:center;gap:6px;background:var(--card);border:1px solid var(--border);border-radius:20px;padding:4px 10px;font-size:.72rem;color:var(--text);font-weight:600;}
.user-avatar{width:20px;height:20px;background:var(--accent);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:.6rem;font-weight:900;color:#fff;}
.body{display:flex;flex:1;overflow:hidden;}
.nav-sidebar{width:52px;flex-shrink:0;background:var(--panel);border-right:1px solid var(--border);display:flex;flex-direction:column;align-items:center;padding:10px 0;gap:4px;}
.nav-icon-btn{width:38px;height:38px;border-radius:10px;border:none;background:transparent;cursor:pointer;font-size:1.1rem;display:flex;align-items:center;justify-content:center;color:var(--sub);transition:all .2s;position:relative;}
.nav-icon-btn:hover{background:var(--card);color:var(--text);}
.nav-icon-btn.active{background:var(--accent);color:#fff;box-shadow:0 3px 12px rgba(108,99,255,.4);}
.nav-icon-btn .tooltip{position:absolute;left:calc(100% + 10px);background:var(--card2);border:1px solid var(--border);color:var(--text);font-size:.7rem;font-weight:600;white-space:nowrap;padding:4px 9px;border-radius:6px;pointer-events:none;opacity:0;transition:opacity .2s;z-index:500;}
.nav-icon-btn:hover .tooltip{opacity:1;}
.nav-divider{width:28px;height:1px;background:var(--border);margin:4px 0;}

/* DASHBOARD */
.dashboard{flex:1;overflow-y:auto;padding:24px 28px;background:var(--bg);animation:fadeIn .4s ease;}
.dash-greeting{margin-bottom:24px;}
.dash-greeting h1{font-family:var(--font-display);font-size:1.9rem;font-weight:900;color:var(--text);}
.dash-greeting p{color:var(--sub);font-size:.87rem;margin-top:4px;}
.greeting-day{color:var(--accent);}
.dash-stats{display:grid;grid-template-columns:repeat(4,1fr);gap:14px;margin-bottom:22px;}
.stat-card{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:18px 20px;position:relative;overflow:hidden;animation:fadeUp .45s cubic-bezier(.16,1,.3,1) both;transition:transform .2s,border-color .2s;}
.stat-card:hover{transform:translateY(-2px);border-color:var(--accent);}
.stat-card::before{content:"";position:absolute;inset:0;opacity:.05;background:radial-gradient(ellipse at top right,var(--c) 0%,transparent 70%);pointer-events:none;}
.stat-card-icon{font-size:1.5rem;margin-bottom:10px;display:block;}
.stat-card-value{font-size:2rem;font-weight:900;font-family:var(--font-display);color:var(--text);line-height:1;}
.stat-card-label{font-size:.72rem;color:var(--sub);margin-top:4px;font-weight:600;text-transform:uppercase;letter-spacing:1px;}
.dash-grid{display:grid;grid-template-columns:1.2fr 1fr;gap:16px;margin-bottom:16px;}
.dash-card{background:var(--card);border:1px solid var(--border);border-radius:14px;overflow:hidden;}
.dash-card-header{padding:14px 18px 10px;display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid var(--border);}
.dash-card-title{font-size:.8rem;font-weight:700;color:var(--text);}
.dash-card-body{padding:16px 18px;}
.dash-card-badge{font-size:.65rem;font-weight:700;background:var(--card2);color:var(--sub);border:1px solid var(--border);padding:2px 8px;border-radius:20px;}
.recent-note-item{display:flex;align-items:center;gap:12px;padding:9px 0;border-bottom:1px solid var(--border);cursor:pointer;transition:all .15s;}
.recent-note-item:last-child{border-bottom:none;}
.rni-dot{width:8px;height:8px;border-radius:50%;flex-shrink:0;}
.rni-info{flex:1;min-width:0;}
.rni-title{font-size:.82rem;font-weight:600;color:var(--text);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;transition:color .15s;}
.recent-note-item:hover .rni-title{color:var(--accent);}
.rni-path{font-size:.67rem;color:var(--sub);margin-top:1px;}
.rni-date{font-size:.63rem;color:var(--sub);font-family:var(--font-mono);flex-shrink:0;}
.dash-empty{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:30px;color:var(--sub);font-size:.82rem;text-align:center;gap:8px;}
.dash-empty-icon{font-size:2rem;opacity:.4;}

/* NOTES APP */
.notes-app{display:flex;flex:1;overflow:hidden;}
.sidebar{width:195px;flex-shrink:0;background:var(--panel);border-right:1px solid var(--border);display:flex;flex-direction:column;overflow:hidden;}
.sidebar-header{padding:11px 12px 6px;font-size:.61rem;font-weight:700;letter-spacing:2px;color:var(--sub);text-transform:uppercase;}
.sidebar-section{display:flex;align-items:center;gap:5px;padding:0 9px 8px;}
.sidebar-section input{flex:1;background:var(--card);border:1px solid var(--border);border-radius:7px;padding:6px 8px;color:var(--text);font-family:var(--font-body);font-size:.79rem;outline:none;transition:border-color .2s;min-width:0;}
.sidebar-section input:focus{border-color:var(--accent);}
.sidebar-section input::placeholder{color:var(--sub);}
.btn-icon{background:var(--accent);color:#fff;border:none;border-radius:7px;width:28px;height:28px;cursor:pointer;font-size:1rem;font-weight:700;transition:all .15s;display:flex;align-items:center;justify-content:center;flex-shrink:0;}
.btn-icon:hover{background:#5549e0;transform:scale(1.08);}
.divider{height:1px;background:var(--border);margin:0 9px 6px;}
.subj-list{flex:1;overflow-y:auto;padding:2px 6px 10px;}
.subj-item{display:flex;align-items:center;border-radius:8px;margin-bottom:2px;cursor:pointer;overflow:hidden;transition:background .15s;animation:slideIn .3s cubic-bezier(.16,1,.3,1) both;}
.subj-item:hover{background:var(--card);}
.subj-item.active{background:var(--card2);}
.subj-dot{width:3px;flex-shrink:0;align-self:stretch;border-radius:3px 0 0 3px;}
.subj-item-inner{padding:7px 8px;flex:1;min-width:0;}
.subj-name{font-size:.81rem;font-weight:600;color:var(--text);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.subj-item.active .subj-name{color:var(--accent);}
.subj-count{font-size:.64rem;color:var(--sub);margin-top:1px;}
.subj-del{background:none;border:none;cursor:pointer;color:var(--sub);font-size:.68rem;padding:7px;opacity:0;transition:opacity .15s,color .15s;}
.subj-item:hover .subj-del{opacity:1;}
.subj-del:hover{color:var(--danger);}
.empty-hint{text-align:center;padding:22px 10px;color:var(--sub);font-size:.77rem;line-height:1.7;}
.chapter-panel{width:178px;flex-shrink:0;background:var(--bg2);border-right:1px solid var(--border);display:flex;flex-direction:column;overflow:hidden;}
.chapter-header{padding:11px 11px 6px;font-size:.61rem;font-weight:700;letter-spacing:2px;color:var(--sub);text-transform:uppercase;}
.chapter-input-row{display:flex;gap:5px;padding:0 8px 8px;}
.chapter-input-row input{flex:1;background:var(--card);border:1px solid var(--border);border-radius:6px;padding:5px 7px;color:var(--text);font-family:var(--font-body);font-size:.77rem;outline:none;transition:border-color .2s;min-width:0;}
.chapter-input-row input:focus{border-color:var(--accent2);}
.chapter-input-row input::placeholder{color:var(--sub);}
.btn-icon-sm{background:var(--accent2);color:#fff;border:none;border-radius:6px;width:24px;height:24px;cursor:pointer;font-size:.85rem;font-weight:700;display:flex;align-items:center;justify-content:center;flex-shrink:0;transition:all .15s;}
.btn-icon-sm:hover{opacity:.85;transform:scale(1.08);}
.chapter-list{flex:1;overflow-y:auto;padding:2px 6px 10px;}
.chapter-item{display:flex;align-items:center;border-radius:7px;margin-bottom:2px;cursor:pointer;overflow:hidden;transition:background .15s;padding:6px 7px;gap:6px;}
.chapter-item:hover{background:var(--card);}
.chapter-item.active{background:var(--card);border-left:2px solid var(--accent2);}
.chapter-icon{font-size:.82rem;flex-shrink:0;}
.chapter-item-inner{flex:1;min-width:0;}
.chapter-name{font-size:.79rem;font-weight:600;color:var(--text);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.chapter-item.active .chapter-name{color:var(--accent2);}
.chapter-notes-count{font-size:.62rem;color:var(--sub);margin-top:1px;}
.chapter-del{background:none;border:none;cursor:pointer;color:var(--sub);font-size:.63rem;opacity:0;transition:all .15s;flex-shrink:0;}
.chapter-item:hover .chapter-del{opacity:1;}
.chapter-del:hover{color:var(--danger);}
.mid-panel{width:248px;flex-shrink:0;background:var(--panel);border-right:1px solid var(--border);display:flex;flex-direction:column;overflow:hidden;}
.mid-header{padding:11px 10px 5px;display:flex;align-items:center;justify-content:space-between;}
.mid-title{font-family:var(--font-display);font-size:.92rem;color:var(--text);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:145px;}
.btn-new-note{background:var(--accent);color:#fff;border:none;border-radius:7px;padding:5px 9px;cursor:pointer;font-size:.71rem;font-weight:600;transition:all .15s;white-space:nowrap;}
.btn-new-note:hover{background:#5549e0;transform:scale(1.04);}
.btn-new-note:disabled{opacity:.4;cursor:not-allowed;}
.note-count{padding:0 10px 4px;font-size:.63rem;color:var(--sub);}
.notes-list{flex:1;overflow-y:auto;padding:4px 6px 12px;}
.note-card{background:var(--card);border:1px solid var(--border);border-radius:9px;padding:10px;margin-bottom:5px;cursor:pointer;transition:all .15s;animation:fadeUp .3s cubic-bezier(.16,1,.3,1) both;}
.note-card:hover{border-color:var(--accent);background:var(--card2);transform:translateY(-1px);}
.note-card.active{border-color:var(--accent);background:var(--card2);box-shadow:0 0 0 1px var(--accent);}
.note-card-title{font-size:.83rem;font-weight:600;color:var(--text);margin-bottom:3px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.note-card.active .note-card-title{color:var(--accent);}
.note-card-snippet{font-size:.69rem;color:var(--sub);margin-bottom:6px;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;line-height:1.5;}
.note-card-footer{display:flex;align-items:center;justify-content:space-between;gap:4px;}
.note-tags{display:flex;gap:3px;flex-wrap:wrap;}
.tag-chip{background:var(--muted);color:var(--accent3);font-size:.59rem;padding:1px 5px;border-radius:4px;font-weight:500;}
.note-date{font-size:.59rem;color:var(--sub);font-family:var(--font-mono);}
.editor-panel{flex:1;display:flex;flex-direction:column;overflow:hidden;background:var(--bg);}
.breadcrumb{display:flex;align-items:center;gap:5px;padding:5px 13px;font-size:.68rem;color:var(--sub);background:var(--card);border-bottom:1px solid var(--border);flex-shrink:0;font-family:var(--font-mono);}
.breadcrumb-sep{color:var(--border);font-size:.8rem;}
.breadcrumb-item.active{color:var(--accent);font-weight:600;}
.editor-toolbar{display:flex;align-items:center;gap:5px;padding:7px 11px;background:var(--panel);border-bottom:1px solid var(--border);flex-wrap:wrap;flex-shrink:0;}
.title-input-wrap{flex:1;min-width:130px;background:var(--card);border:1px solid var(--border);border-radius:8px;padding:0 11px;transition:border-color .2s;}
.title-input-wrap:focus-within{border-color:var(--accent);}
.title-input{width:100%;background:none;border:none;outline:none;color:var(--text);font-family:var(--font-display);font-size:.93rem;padding:7px 0;}
.title-input::placeholder{color:var(--sub);}
.title-input:disabled{opacity:.4;}
.fmt-group{display:flex;gap:3px;}
.fmt-btn{background:var(--card);color:var(--text);border:1px solid var(--border);border-radius:6px;padding:4px 8px;cursor:pointer;font-size:.76rem;font-weight:600;transition:all .15s;}
.fmt-btn:hover{background:var(--card2);border-color:var(--accent);transform:scale(1.05);}
.fmt-btn.highlight{background:rgba(255,209,102,.1);color:var(--gold);border-color:rgba(255,209,102,.3);}
.fmt-btn.bullet{color:var(--accent3);}
.btn-media{background:rgba(67,232,216,.1);color:var(--accent3);border:1px solid rgba(67,232,216,.3);border-radius:6px;padding:4px 9px;cursor:pointer;font-size:.74rem;font-weight:600;transition:all .15s;display:flex;align-items:center;gap:4px;white-space:nowrap;}
.btn-media:hover{background:rgba(67,232,216,.18);transform:scale(1.05);}
.btn-media:disabled{opacity:.4;cursor:not-allowed;}
.btn-save{background:var(--success);color:#fff;border:none;border-radius:7px;padding:5px 12px;cursor:pointer;font-size:.76rem;font-weight:700;transition:all .2s;}
.btn-save:hover{opacity:.85;transform:scale(1.04);}
.btn-save.pulse{animation:savePulse .5s ease;}
.btn-save:disabled{opacity:.4;cursor:not-allowed;}
.btn-delete{background:rgba(255,107,107,.1);color:var(--danger);border:1px solid rgba(255,107,107,.3);border-radius:7px;padding:5px 9px;cursor:pointer;font-size:.76rem;font-weight:600;transition:all .15s;}
.btn-delete:hover{background:rgba(255,107,107,.2);transform:scale(1.04);}
.btn-delete:disabled{opacity:.4;cursor:not-allowed;}
.download-wrap{position:relative;}
.btn-download{display:flex;align-items:center;gap:5px;background:linear-gradient(135deg,var(--accent),#8B5CF6);color:#fff;border:none;border-radius:7px;padding:5px 11px;cursor:pointer;font-size:.76rem;font-weight:700;transition:all .2s;white-space:nowrap;box-shadow:0 2px 10px rgba(108,99,255,.35);}
.btn-download:hover{transform:scale(1.04);box-shadow:0 4px 18px rgba(108,99,255,.5);}
.btn-download:disabled{opacity:.4;cursor:not-allowed;box-shadow:none;}
.btn-download svg{transition:transform .2s;}
.btn-download.open svg{transform:rotate(180deg);}
.download-dropdown{position:absolute;top:calc(100% + 6px);right:0;background:var(--card2);border:1px solid var(--border);border-radius:12px;padding:6px;min-width:190px;z-index:9000;animation:dropIn .2s cubic-bezier(.16,1,.3,1) both;box-shadow:0 12px 40px var(--shadow);}
.download-dropdown-title{font-size:.6rem;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;color:var(--sub);padding:4px 10px 8px;}
.dl-option{display:flex;align-items:center;gap:10px;padding:9px 12px;border-radius:8px;cursor:pointer;transition:background .15s;}
.dl-option:hover{background:var(--card);}
.dl-option-icon{font-size:1.2rem;width:28px;height:28px;display:flex;align-items:center;justify-content:center;border-radius:7px;}
.dl-option-icon.pdf{background:rgba(255,107,107,.15);}
.dl-option-icon.word{background:rgba(67,160,255,.15);}
.dl-option-label{font-size:.8rem;font-weight:700;color:var(--text);}
.dl-option-sub{font-size:.64rem;color:var(--sub);margin-top:1px;}
.dl-loading{display:flex;align-items:center;gap:8px;padding:10px 12px;font-size:.78rem;color:var(--sub);}
.dl-spinner{width:14px;height:14px;border:2px solid var(--border);border-top-color:var(--accent);border-radius:50%;animation:spin 0.7s linear infinite;flex-shrink:0;}
.tag-bar{display:flex;align-items:center;gap:8px;padding:5px 13px;background:var(--card);border-bottom:1px solid var(--border);flex-shrink:0;}
.tag-bar-label{font-size:.68rem;color:var(--sub);white-space:nowrap;}
.tag-bar-input{flex:1;background:none;border:none;outline:none;color:var(--accent);font-size:.71rem;font-family:var(--font-mono);}
.tag-bar-input::placeholder{color:var(--muted);}
.tag-bar-input:disabled{opacity:.4;}
.wcount{font-size:.67rem;color:var(--sub);white-space:nowrap;font-family:var(--font-mono);}
.last-saved{font-size:.64rem;color:var(--success);white-space:nowrap;font-family:var(--font-mono);opacity:0;transition:opacity .4s;}
.last-saved.show{opacity:1;}
.editor-area{flex:1;padding:20px 24px;overflow-y:auto;font-family:var(--font-mono);font-size:.9rem;line-height:1.85;color:var(--text);outline:none;caret-color:var(--accent);}
.editor-area[contenteditable="false"]{color:var(--sub);cursor:default;}
.editor-area:empty::before{content:attr(data-placeholder);color:var(--sub);pointer-events:none;}
.editor-area b,.editor-area strong{font-weight:700;}
.editor-area i,.editor-area em{color:var(--accent3);}
.editor-area img{max-width:100%;border-radius:8px;margin:8px 0;border:1px solid var(--border);display:block;}
.editor-area video{max-width:100%;border-radius:8px;margin:8px 0;border:1px solid var(--border);display:block;}
.media-strip{display:flex;gap:8px;padding:8px 24px;flex-shrink:0;overflow-x:auto;border-top:1px solid var(--border);background:var(--card);}
.media-strip:empty{display:none;}
.media-thumb{position:relative;flex-shrink:0;}
.media-thumb img,.media-thumb video{width:64px;height:64px;object-fit:cover;border-radius:8px;border:1px solid var(--border);cursor:pointer;}
.media-thumb:hover .media-thumb-del,.media-thumb:hover .media-insert-btn{opacity:1;}
.media-thumb-del{position:absolute;top:-5px;right:-5px;width:18px;height:18px;background:var(--danger);border:none;border-radius:50%;cursor:pointer;font-size:.6rem;color:#fff;display:flex;align-items:center;justify-content:center;opacity:0;transition:opacity .2s;}
.media-thumb-type{position:absolute;bottom:3px;left:3px;background:rgba(0,0,0,.6);color:#fff;font-size:.5rem;font-weight:700;padding:1px 4px;border-radius:3px;}
.media-insert-btn{position:absolute;bottom:3px;right:3px;background:var(--accent);border:none;border-radius:3px;color:#fff;font-size:.55rem;padding:2px 5px;cursor:pointer;opacity:0;transition:opacity .2s;white-space:nowrap;}
.statusbar{padding:4px 13px;background:var(--bg2);border-top:1px solid var(--border);font-size:.67rem;color:var(--sub);font-family:var(--font-mono);flex-shrink:0;display:flex;align-items:center;justify-content:space-between;}
.statusbar .ok{color:var(--success);}.statusbar .err{color:var(--danger);}.statusbar .info{color:var(--accent);}
.welcome{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:10px;color:var(--sub);animation:fadeIn .4s ease;padding:20px;}
.welcome h2{font-family:var(--font-display);font-size:1.4rem;color:var(--text);text-align:center;}
.welcome p{font-size:.81rem;max-width:320px;text-align:center;line-height:1.6;}
.welcome-path{display:flex;align-items:center;gap:7px;background:var(--card);border:1px solid var(--border);border-radius:10px;padding:9px 14px;font-size:.78rem;color:var(--sub);}
.welcome-path-step{color:var(--text);font-weight:600;}
.welcome-path-arrow{color:var(--accent);}
.shortcuts{display:flex;flex-wrap:wrap;gap:6px;justify-content:center;margin-top:6px;}
.shortcut-item{background:var(--card);border:1px solid var(--border);border-radius:7px;padding:5px 10px;font-size:.71rem;display:flex;gap:5px;align-items:center;}
.kbd{background:var(--muted);color:var(--sub);border-radius:4px;padding:1px 5px;font-size:.61rem;font-family:var(--font-mono);}
.toast-container{position:fixed;bottom:20px;right:20px;display:flex;flex-direction:column;gap:7px;z-index:9999;}
.toast{display:flex;align-items:center;gap:9px;padding:10px 14px;border-radius:10px;background:var(--card2);border:1px solid var(--border);font-size:.79rem;font-weight:500;color:var(--text);box-shadow:0 8px 32px var(--shadow);animation:toastIn .35s cubic-bezier(.16,1,.3,1) both;min-width:200px;}
.toast.exit{animation:toastOut .3s ease forwards;}
.toast.success{border-color:var(--success);}.toast.error{border-color:var(--danger);}.toast.warn{border-color:var(--gold);}
.dialog-overlay{position:fixed;inset:0;background:rgba(0,0,0,.72);display:flex;align-items:center;justify-content:center;z-index:9998;animation:fadeIn .2s ease;}
.dialog-box{background:var(--card2);border:1px solid var(--border);border-radius:14px;padding:26px 28px;max-width:350px;width:90%;text-align:center;animation:popIn .3s cubic-bezier(.34,1.56,.64,1);}
.dialog-icon{font-size:2rem;margin-bottom:11px;}
.dialog-msg{font-size:.86rem;line-height:1.65;color:var(--text);margin-bottom:18px;white-space:pre-wrap;}
.dialog-btns{display:flex;gap:10px;justify-content:center;}
.splash{position:fixed;inset:0;background:var(--bg);display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:9999;transition:opacity .5s ease;}
.splash.hide{opacity:0;pointer-events:none;}
.splash-title{font-family:var(--font-display);font-size:2.6rem;color:var(--text);animation:fadeUp .5s ease .4s both;letter-spacing:-1px;}
.splash-sub{color:var(--sub);font-size:.92rem;margin-top:7px;animation:fadeUp .5s ease .55s both;}
.splash-bar-wrap{width:230px;height:3px;background:var(--card);border-radius:3px;margin-top:32px;overflow:hidden;}
.splash-bar{height:100%;background:linear-gradient(90deg,var(--accent),var(--accent3));border-radius:3px;width:0%;transition:width .05s linear;}
.api-banner{background:rgba(255,209,102,.12);border-bottom:1px solid rgba(255,209,102,.3);padding:6px 16px;font-size:.72rem;color:var(--gold);text-align:center;flex-shrink:0;}
.loading-overlay{position:fixed;inset:0;background:rgba(8,11,20,.8);display:flex;align-items:center;justify-content:center;z-index:9990;font-size:.9rem;color:var(--sub);gap:10px;}
.spinner{width:20px;height:20px;border:2px solid var(--border);border-top-color:var(--accent);border-radius:50%;animation:spin .7s linear infinite;}
</style>
</head>
<body>
<div id="root"></div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.development.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.development.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>

<!-- â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
     â•‘  ğŸ”§ SIRF YE EK LINE CHANGE KARO â€” APNA VERCEL URL DAALO â•‘
     â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<script>
const API_URL = "https://collage-notesb.vercel.app/api";
//               â†‘â†‘â†‘ Vercel deploy ke baad apna URL yahan paste karo â†‘â†‘â†‘

// Auth helpers â€” token localStorage mein store karte hain
const Auth = {
  getToken:    ()  => localStorage.getItem("nv_token"),
  setToken:    (t) => localStorage.setItem("nv_token", t),
  removeToken: ()  => { localStorage.removeItem("nv_token"); localStorage.removeItem("nv_user"); },
  getUser:     ()  => { try { return JSON.parse(localStorage.getItem("nv_user")||"null"); } catch { return null; } },
  setUser:     (u) => localStorage.setItem("nv_user", JSON.stringify(u)),
  isLoggedIn:  ()  => !!localStorage.getItem("nv_token"),
};

// Universal API fetch â€” har request mein JWT token automatically add hota hai
async function apiFetch(endpoint, options={}) {
  const token = Auth.getToken();
  const res = await fetch(`${API_URL}${endpoint}`, {
    ...options,
    headers: {
      "Content-Type": "application/json",
      ...(token ? {"Authorization": `Bearer ${token}`} : {}),
      ...(options.headers || {}),
    },
  });
  const data = await res.json().catch(()=>({}));
  if (res.status === 401) { Auth.removeToken(); window.location.reload(); }
  if (!res.ok) throw new Error(data.error || `HTTP ${res.status}`);
  return data;
}

// All API methods
const API = {
  // Auth
  signup: (d)       => apiFetch("/auth/signup",  {method:"POST", body:JSON.stringify(d)}),
  login:  (d)       => apiFetch("/auth/login",   {method:"POST", body:JSON.stringify(d)}),
  logout: ()        => apiFetch("/auth/logout",  {method:"POST"}),

  // Dashboard
  dashStats: ()     => apiFetch("/dashboard/stats"),

  // Subjects (MongoDB se)
  getSubjects:   ()      => apiFetch("/subjects"),
  createSubject: (d)     => apiFetch("/subjects",       {method:"POST",   body:JSON.stringify(d)}),
  deleteSubject: (id)    => apiFetch(`/subjects/${id}`, {method:"DELETE"}),

  // Chapters
  getChapters:   (sid)   => apiFetch(`/chapters?subject_id=${sid}`),
  createChapter: (d)     => apiFetch("/chapters",       {method:"POST",   body:JSON.stringify(d)}),
  deleteChapter: (id)    => apiFetch(`/chapters/${id}`, {method:"DELETE"}),

  // Notes
  getNotes:    (cid)     => apiFetch(`/notes?chapter_id=${cid}`),
  createNote:  (d)       => apiFetch("/notes",          {method:"POST",   body:JSON.stringify(d)}),
  updateNote:  (id, d)   => apiFetch(`/notes/${id}`,    {method:"PUT",    body:JSON.stringify(d)}),
  deleteNote:  (id)      => apiFetch(`/notes/${id}`,    {method:"DELETE"}),
};
</script>

<script type="text/babel">
const {useState, useEffect, useRef, useCallback} = React;

const COLORS  = ["#6C63FF","#FF6584","#43E8D8","#FFD166","#06D6A0","#F472B6","#60A5FA","#A78BFA"];
const ICONS   = ["âš—ï¸","ğŸ“","ğŸ“–","ğŸŒ","ğŸ’»","ğŸ¨","ğŸ§¬","ğŸ“Š","ğŸ”¬","ğŸ“","ğŸ›ï¸","âš™ï¸"];
const CH_ICONS= ["ğŸ“‘","ğŸ“‹","ğŸ“Œ","ğŸ—‚ï¸","ğŸ“","ğŸ”–","ğŸ“’","ğŸ““","ğŸ“”","ğŸ“•","ğŸ“—","ğŸ“˜"];

// â”€â”€â”€ PDF Download â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function downloadAsPDF(title, html, tags, subj, ch) {
  const date = new Date().toLocaleDateString("en-IN",{day:"2-digit",month:"long",year:"numeric"});
  const w = window.open("","_blank");
  w.document.write(`<!DOCTYPE html><html><head><meta charset="UTF-8"><title>${title}</title>
<style>body{font-family:Georgia,serif;max-width:700px;margin:40px auto;color:#1a1a2e;line-height:1.8;padding:20px;}
.hd{border-bottom:3px solid #6C63FF;padding-bottom:18px;margin-bottom:24px;}
.logo{font-size:1rem;font-weight:900;color:#6C63FF;margin-bottom:6px;}
h1{font-size:2rem;font-weight:900;margin:0 0 8px;}
.meta{font-size:.8rem;color:#666;margin-bottom:8px;}
.path{background:#f0efff;border:1px solid #d4d0ff;border-radius:8px;padding:8px 14px;font-size:.82rem;color:#5B52E8;margin-bottom:20px;}
.content{font-size:1rem;line-height:1.9;}
.ft{margin-top:40px;padding-top:14px;border-top:1px solid #eee;font-size:.75rem;color:#999;text-align:center;}</style>
</head><body>
<div class="hd"><div class="logo">ğŸ“š NoteVault</div><h1>${title}</h1>
<div class="meta">ğŸ“… ${date}${tags?" | ğŸ· "+tags:""}</div></div>
${subj&&ch?`<div class="path">ğŸ“š ${subj} â€º ğŸ“‘ ${ch} â€º ğŸ“ ${title}</div>`:""}
<div class="content">${html||"<em>No content</em>"}</div>
<div class="ft">Generated by NoteVault â€¢ ${date}</div>
</body></html>`);
  w.document.close(); w.focus();
  setTimeout(()=>w.print(), 600);
}

// â”€â”€â”€ Word Download â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function downloadAsWord(title, html, tags, subj, ch) {
  const date = new Date().toLocaleDateString("en-IN",{day:"2-digit",month:"long",year:"numeric"});
  const clean = html.replace(/<img[^>]*src="data:[^"]*"[^>]*>/g,"<p><em>[Image]</em></p>").replace(/<video[^>]*>.*?<\/video>/gs,"<p><em>[Video]</em></p>");
  const blob = new Blob(['\ufeff'+`<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:w="urn:schemas-microsoft-com:office:word" xmlns="http://www.w3.org/TR/REC-html40"><head><meta charset="UTF-8"><style>body{font-family:Calibri;font-size:12pt;margin:2cm;}h1{font-size:24pt;border-bottom:3pt solid #6C63FF;}div.path{background:#f0efff;padding:6pt;font-size:9pt;color:#5B52E8;}</style></head><body><div class="logo"><b>ğŸ“š NoteVault</b></div><h1>${title}</h1><p>ğŸ“… ${date}${tags?" | ğŸ· "+tags:""}</p>${subj&&ch?`<div class="path">ğŸ“š ${subj} â€º ğŸ“‘ ${ch} â€º ğŸ“ ${title}</div>`:""}<div>${clean}</div><p><small>Generated by NoteVault</small></p></body></html>`],{type:"application/msword"});
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = `${title.replace(/[^a-z0-9]/gi,"_")}.doc`;
  a.click(); URL.revokeObjectURL(a.href);
}

// â”€â”€â”€ Hooks â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function useToast() {
  const [toasts,setToasts] = useState([]);
  const toast = useCallback((msg,kind="success")=>{
    const id = Date.now();
    setToasts(p=>[...p,{id,msg,kind}]);
    setTimeout(()=>setToasts(p=>p.map(t=>t.id===id?{...t,exit:true}:t)),2700);
    setTimeout(()=>setToasts(p=>p.filter(t=>t.id!==id)),3100);
  },[]);
  return {toasts,toast};
}
function useConfirm() {
  const [state,setState] = useState(null);
  const confirm = useCallback((msg)=>new Promise(r=>setState({msg,r})),[]);
  const Dialog = state?(
    <div className="dialog-overlay">
      <div className="dialog-box">
        <div className="dialog-icon">âš ï¸</div>
        <div className="dialog-msg">{state.msg}</div>
        <div className="dialog-btns">
          <button className="btn-delete" onClick={()=>{state.r(false);setState(null);}}>Cancel</button>
          <button className="btn-save" onClick={()=>{state.r(true);setState(null);}}>Confirm</button>
        </div>
      </div>
    </div>
  ):null;
  return {confirm,Dialog};
}
function Clock() {
  const [t,setT] = useState("");
  useEffect(()=>{
    const tick=()=>setT(new Date().toLocaleString("en-IN",{weekday:"short",day:"2-digit",month:"short",hour:"2-digit",minute:"2-digit",second:"2-digit"}));
    tick(); const id=setInterval(tick,1000); return()=>clearInterval(id);
  },[]);
  return <span className="clock">{t}</span>;
}
function Logo({size=34}) {
  return (
    <svg className="logo-icon" width={size} height={size} viewBox="0 0 40 40" fill="none">
      <rect x="5" y="8" width="22" height="26" rx="3" fill="var(--accent)" opacity=".85"/>
      <rect x="8" y="8" width="22" height="26" rx="3" fill="var(--accent)" opacity=".6"/>
      <rect x="11" y="8" width="22" height="26" rx="3" fill="var(--accent)"/>
      <rect x="11" y="8" width="4" height="26" rx="1" fill="rgba(0,0,0,0.22)"/>
      <rect x="18" y="15" width="10" height="2" rx="1" fill="rgba(255,255,255,0.85)"/>
      <rect x="18" y="20" width="13" height="2" rx="1" fill="rgba(255,255,255,0.65)"/>
      <rect x="18" y="25" width="8" height="2" rx="1" fill="rgba(255,255,255,0.5)"/>
      <circle cx="32" cy="10" r="5" fill="var(--accent3)" opacity=".95"/>
      <text x="29.5" y="13.5" fontSize="7" fill="#fff" fontWeight="bold">âœ¦</text>
    </svg>
  );
}
function Splash({onDone}) {
  const [p,setP] = useState(0);
  const [hide,setHide] = useState(false);
  useEffect(()=>{
    let v=0; const id=setInterval(()=>{v+=2;setP(Math.min(v,100));if(v>=100){clearInterval(id);setTimeout(()=>{setHide(true);setTimeout(onDone,500)},300);}},28);
    return()=>clearInterval(id);
  },[]);
  return (
    <div className={`splash ${hide?"hide":""}`}>
      <Logo size={76}/>
      <h1 className="splash-title">NoteVault</h1>
      <p className="splash-sub">Connecting to MongoDB Atlasâ€¦</p>
      <div className="splash-bar-wrap"><div className="splash-bar" style={{width:`${p}%`}}/></div>
    </div>
  );
}

// â”€â”€â”€ AUTH SCREEN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function AuthScreen({onAuth}) {
  const [mode,setMode] = useState("login");
  const [form,setForm] = useState({username:"",email:"",password:""});
  const [loading,setLoading] = useState(false);
  const [error,setError] = useState("");
  const upd = (k,v) => setForm(p=>({...p,[k]:v}));

  // Check if API_URL is still placeholder
  const isPlaceholder = API_URL.includes("YOUR-APP-NAME");

  async function submit() {
    setError(""); setLoading(true);
    try {
      const res = mode==="login"
        ? await API.login({email:form.email, password:form.password})
        : await API.signup(form);
      Auth.setToken(res.token);
      Auth.setUser(res.user);
      onAuth(res.user);
    } catch(e) {
      setError(e.message);
    } finally { setLoading(false); }
  }

  return (
    <div className="auth-screen">
      <div className="auth-box">
        <Logo size={52}/>
        <h2 className="auth-title">NoteVault</h2>
        <p className="auth-sub">{mode==="login"?"Welcome back! Log in to continue.":"Create your free account."}</p>

        {isPlaceholder && (
          <div className="auth-error">
            âš ï¸ <b>API_URL not set!</b><br/>
            index.html mein <code>API_URL</code> ko apne Vercel backend URL se replace karo.
          </div>
        )}
        {error && <div className="auth-error">âŒ {error}</div>}

        {mode==="signup" && <input className="auth-input" placeholder="Username" value={form.username} onChange={e=>upd("username",e.target.value)}/>}
        <input className="auth-input" placeholder="Email address" type="email" value={form.email} onChange={e=>upd("email",e.target.value)}/>
        <input className="auth-input" placeholder="Password" type="password" value={form.password} onChange={e=>upd("password",e.target.value)} onKeyDown={e=>e.key==="Enter"&&submit()}/>
        <button className="auth-btn" onClick={submit} disabled={loading||isPlaceholder}>
          {loading ? "Please waitâ€¦" : mode==="login" ? "ğŸ”‘ Log In" : "ğŸš€ Create Account"}
        </button>
        <p className="auth-switch">
          {mode==="login"?"Don't have an account? ":"Already registered? "}
          <span onClick={()=>{setMode(m=>m==="login"?"signup":"login");setError("");}}>
            {mode==="login"?"Sign up free":"Log in"}
          </span>
        </p>
      </div>
    </div>
  );
}

// â”€â”€â”€ DOWNLOAD BUTTON â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function DownloadButton({disabled, onPDF, onWord}) {
  const [open,setOpen] = useState(false);
  const [loading,setLoading] = useState(null);
  const ref = useRef(null);
  useEffect(()=>{
    const h=e=>{if(ref.current&&!ref.current.contains(e.target))setOpen(false);};
    document.addEventListener("mousedown",h); return()=>document.removeEventListener("mousedown",h);
  },[]);
  async function handle(type) {
    setLoading(type); await new Promise(r=>setTimeout(r,300));
    type==="pdf"?onPDF():onWord(); setLoading(null); setOpen(false);
  }
  return (
    <div className="download-wrap" ref={ref}>
      <button className={`btn-download ${open?"open":""}`} onClick={()=>!disabled&&setOpen(o=>!o)} disabled={disabled}>
        â¬‡ Download <svg width="11" height="11" viewBox="0 0 10 10" fill="none"><path d="M2 3.5L5 6.5L8 3.5" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round"/></svg>
      </button>
      {open && (
        <div className="download-dropdown">
          <div className="download-dropdown-title">Choose Format</div>
          {loading ? <div className="dl-loading"><div className="dl-spinner"/> Preparing {loading.toUpperCase()}â€¦</div> : (
            <>
              <div className="dl-option" onClick={()=>handle("pdf")}><div className="dl-option-icon pdf">ğŸ“„</div><div><div className="dl-option-label">Download PDF</div><div className="dl-option-sub">Print dialog â†’ Save as PDF</div></div></div>
              <div className="dl-option" onClick={()=>handle("word")}><div className="dl-option-icon word">ğŸ“</div><div><div className="dl-option-label">Download Word</div><div className="dl-option-sub">Saves as .doc file</div></div></div>
            </>
          )}
        </div>
      )}
    </div>
  );
}

// â”€â”€â”€ DASHBOARD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function Dashboard({stats, onQuickNote}) {
  const greetHour = new Date().getHours();
  const greet = greetHour<12?"Good Morning":greetHour<17?"Good Afternoon":"Good Evening";
  const s = stats || {};
  const recentNotes = s.recent_notes || [];
  const subjects = s.subjects || [];

  return (
    <div className="dashboard">
      <div className="dash-greeting">
        <h1><span className="greeting-day">{greet}!</span> Ready to Study?</h1>
        <p>NoteVault Dashboard â€” {new Date().toLocaleDateString("en-IN",{weekday:"long",day:"numeric",month:"long",year:"numeric"})}</p>
      </div>
      <div className="dash-stats">
        {[
          {icon:"ğŸ“š",value:s.total_subjects||0,label:"Subjects",color:COLORS[0]},
          {icon:"ğŸ“‘",value:s.total_chapters||0,label:"Chapters",color:COLORS[1]},
          {icon:"ğŸ“",value:s.total_notes||0,label:"Notes",color:COLORS[2]},
          {icon:"âœï¸",value:(s.total_words||0).toLocaleString(),label:"Words Written",color:COLORS[3]},
        ].map((c,i)=>(
          <div key={i} className="stat-card" style={{"--c":c.color,animationDelay:`${i*80}ms`}}>
            <span className="stat-card-icon">{c.icon}</span>
            <div className="stat-card-value">{c.value}</div>
            <div className="stat-card-label">{c.label}</div>
          </div>
        ))}
      </div>
      <div className="dash-grid">
        <div className="dash-card">
          <div className="dash-card-header"><span className="dash-card-title">ğŸ• Recent Notes</span><span className="dash-card-badge">{recentNotes.length} shown</span></div>
          <div className="dash-card-body" style={{padding:"8px 16px"}}>
            {recentNotes.length===0 ? <div className="dash-empty"><div className="dash-empty-icon">ğŸ“­</div>No notes yet!</div>
            : recentNotes.map((n,i)=>(
              <div key={n.id||i} className="recent-note-item">
                <div className="rni-dot" style={{background:COLORS[i%COLORS.length]}}/>
                <div className="rni-info">
                  <div className="rni-title">{n.title||"Untitled"}</div>
                  <div className="rni-path">{n.subject_name} â€º {n.chapter_name}</div>
                </div>
                <span className="rni-date">{n.modified||""}</span>
              </div>
            ))}
          </div>
        </div>
        <div className="dash-card">
          <div className="dash-card-header"><span className="dash-card-title">ğŸ“š My Subjects</span><span className="dash-card-badge">{subjects.length} total</span></div>
          <div className="dash-card-body">
            {subjects.length===0 ? <div className="dash-empty"><div className="dash-empty-icon">ğŸ“š</div>No subjects yet</div>
            : subjects.map((s,i)=>(
              <div key={s.id||i} style={{marginBottom:12}}>
                <div style={{display:"flex",justifyContent:"space-between",marginBottom:5}}>
                  <span style={{fontSize:".8rem",fontWeight:600,color:"var(--text)"}}>{ICONS[i%ICONS.length]} {s.name}</span>
                  <span style={{fontSize:".7rem",color:"var(--sub)",fontFamily:"var(--font-mono)"}}>{s.note_count||0}n</span>
                </div>
                <div style={{height:5,background:"var(--muted)",borderRadius:5,overflow:"hidden"}}>
                  <div style={{height:"100%",width:`${Math.min(100,((s.note_count||0)/Math.max(...subjects.map(x=>x.note_count||0),1))*100)}%`,background:COLORS[i%COLORS.length],borderRadius:5,transition:"width .8s"}}/>
                </div>
              </div>
            ))}
          </div>
        </div>
      </div>
      <div style={{marginTop:16,display:"flex",gap:10}}>
        {[{icon:"ğŸ“",text:"New Note",fn:onQuickNote},{icon:"ğŸ”¥",text:`Study Streak: ${s.streak_days||0} days`,fn:()=>{}}].map((a,i)=>(
          <button key={i} onClick={a.fn} style={{background:"var(--card)",border:"1px solid var(--border)",borderRadius:10,padding:"12px 18px",cursor:"pointer",fontSize:".82rem",fontWeight:600,color:"var(--text)",transition:"all .2s",fontFamily:"var(--font-body)"}}>
            {a.icon} {a.text}
          </button>
        ))}
      </div>
    </div>
  );
}

// â”€â”€â”€ MAIN APP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function App() {
  const [splashDone,setSplashDone]   = useState(false);
  const [currentUser,setCurrentUser] = useState(()=>Auth.getUser());
  const [theme,setTheme]             = useState(()=>localStorage.getItem("nv_theme")||"dark");
  const [view,setView]               = useState("dashboard");

  // MongoDB data state
  const [subjects,setSubjects]       = useState([]);
  const [chapters,setChapters]       = useState([]);
  const [notes,setNotes]             = useState([]);
  const [dashStats,setDashStats]     = useState(null);

  // Selection
  const [curSubj,setCurSubj]         = useState(null);
  const [curChapter,setCurChapter]   = useState(null);
  const [curNid,setCurNid]           = useState(null);

  // Editor
  const [noteTitle,setNoteTitle]     = useState("");
  const [noteTags,setNoteTags]       = useState("");
  const [subjInput,setSubjInput]     = useState("");
  const [chInput,setChInput]         = useState("");
  const [search,setSearch]           = useState("");
  const [autoSaveStatus,setAS]       = useState("idle");
  const [lastSaved,setLastSaved]     = useState("");
  const [showLS,setShowLS]           = useState(false);
  const [savePulse,setSavePulse]     = useState(false);
  const [status,setStatus]           = useState("Ready");
  const [statusKind,setStatusKind]   = useState("");
  const [mediaFiles,setMediaFiles]   = useState([]);
  const [globalLoading,setGLoading]  = useState(false);

  const editorRef   = useRef(null);
  const autoSaveRef = useRef(null);
  const {toasts,toast}   = useToast();
  const {confirm,Dialog} = useConfirm();

  const isAuthed = Auth.isLoggedIn() && !!currentUser;

  // Theme
  useEffect(()=>{document.documentElement.setAttribute("data-theme",theme);localStorage.setItem("nv_theme",theme);},[theme]);

  // Initial data load
  useEffect(()=>{ if(isAuthed){ loadSubjects(); loadDash(); } },[isAuthed]);
  useEffect(()=>{ if(isAuthed&&view==="dashboard") loadDash(); },[view]);
  useEffect(()=>{ if(curSubj) loadChapters(curSubj.id); else setChapters([]); },[curSubj]);
  useEffect(()=>{ if(curChapter) loadNotes(curChapter.id); else setNotes([]); },[curChapter]);

  // Auto-save trigger
  useEffect(()=>{
    if(!curNid) return;
    setAS("saving");
    clearTimeout(autoSaveRef.current);
    autoSaveRef.current = setTimeout(()=>doSave(true), 2500);
    return()=>clearTimeout(autoSaveRef.current);
  },[noteTitle,noteTags]);

  // Keyboard shortcuts
  useEffect(()=>{
    const h=e=>{
      if((e.ctrlKey||e.metaKey)&&e.key==="s"){e.preventDefault();doSave(false);}
      if((e.ctrlKey||e.metaKey)&&e.key==="n"){e.preventDefault();handleAddNote();}
      if((e.ctrlKey||e.metaKey)&&e.key==="b"){e.preventDefault();fmt("bold");}
      if((e.ctrlKey||e.metaKey)&&e.key==="i"){e.preventDefault();fmt("italic");}
    };
    window.addEventListener("keydown",h); return()=>window.removeEventListener("keydown",h);
  });

  // â”€â”€ API Loaders â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function loadSubjects() { try{const r=await API.getSubjects();setSubjects(r.subjects||[]);}catch(e){toast(e.message,"error");} }
  async function loadChapters(sid) { try{const r=await API.getChapters(sid);setChapters(r.chapters||[]);}catch(e){toast(e.message,"error");} }
  async function loadNotes(cid) { try{const r=await API.getNotes(cid);setNotes(r.notes||[]);}catch(e){toast(e.message,"error");} }
  async function loadDash() { try{const r=await API.dashStats();setDashStats(r);}catch(_){} }

  // â”€â”€ CRUD Subjects â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function handleAddSubj(e) {
    if(e?.key&&e.key!=="Enter") return;
    const name=subjInput.trim(); if(!name) return;
    try {
      const r = await API.createSubject({name, color:COLORS[subjects.length%COLORS.length], icon:ICONS[subjects.length%ICONS.length]});
      setSubjInput(""); await loadSubjects();
      setCurSubj(r.subject); setCurChapter(null); setCurNid(null); clearEditor(); setView("notes");
      toast(`Subject "${name}" created! ğŸ“`);
    } catch(e){toast(e.message,"error");}
  }
  async function handleDelSubj(subj) {
    const ok = await confirm(`Delete "${subj.name}" and all its data?\nCannot be undone.`);
    if(!ok) return;
    try {
      await API.deleteSubject(subj.id);
      await loadSubjects();
      if(curSubj?.id===subj.id){setCurSubj(null);setCurChapter(null);setCurNid(null);clearEditor();}
      toast(`Deleted "${subj.name}"`,"error");
    } catch(e){toast(e.message,"error");}
  }

  // â”€â”€ CRUD Chapters â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function handleAddChapter(e) {
    if(e?.key&&e.key!=="Enter") return;
    if(!curSubj){toast("Select a subject first","warn");return;}
    const name=chInput.trim(); if(!name) return;
    try {
      const r = await API.createChapter({subject_id:curSubj.id, name, icon:CH_ICONS[chapters.length%CH_ICONS.length]});
      setChInput(""); await loadChapters(curSubj.id);
      setCurChapter(r.chapter); setCurNid(null); clearEditor();
      toast(`Chapter "${name}" created! ğŸ“‘`);
    } catch(e){toast(e.message,"error");}
  }
  async function handleDelChapter(ch) {
    const ok = await confirm(`Delete chapter "${ch.name}" and all notes?\nCannot be undone.`);
    if(!ok) return;
    try {
      await API.deleteChapter(ch.id);
      await loadChapters(curSubj.id);
      if(curChapter?.id===ch.id){setCurChapter(null);setCurNid(null);clearEditor();}
      toast(`Deleted "${ch.name}"`,"error");
    } catch(e){toast(e.message,"error");}
  }

  // â”€â”€ CRUD Notes â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function handleAddNote() {
    if(!curSubj){toast("Select a subject first","warn");setView("notes");return;}
    if(!curChapter){toast("Select a chapter first","warn");return;}
    try {
      const r = await API.createNote({subject_id:curSubj.id, chapter_id:curChapter.id, title:"New Note", content:"", tags:""});
      await loadNotes(curChapter.id);
      loadNote(r.note.id, r.note);
    } catch(e){toast(e.message,"error");}
  }
  function loadNote(nid, note) {
    setCurNid(nid); setNoteTitle(note.title||""); setNoteTags(note.tags||""); setMediaFiles([]);
    if(editorRef.current){editorRef.current.innerHTML=note.content||"";editorRef.current.contentEditable="true";}
    setStatus(`Editing: ${note.title} Â· Ctrl+S to save`); setStatusKind("info");
  }
  function clearEditor() {
    setCurNid(null); setNoteTitle(""); setNoteTags(""); setMediaFiles([]);
    if(editorRef.current){editorRef.current.innerHTML="";editorRef.current.contentEditable="false";}
    setStatus("Ready"); setStatusKind("");
  }
  async function doSave(silent=false) {
    if(!curNid) return;
    const content = editorRef.current?.innerHTML||"";
    try {
      await API.updateNote(curNid, {title:noteTitle||"Untitled", content, tags:noteTags});
      const now = new Date().toLocaleString("en-IN",{day:"2-digit",month:"short",hour:"2-digit",minute:"2-digit"});
      setAS("saved"); setLastSaved(`Saved ${now}`); setShowLS(true);
      setTimeout(()=>setShowLS(false),3000); setTimeout(()=>setAS("idle"),3000);
      setStatus(`âœ… Saved "${noteTitle||"Untitled"}"`); setStatusKind("ok");
      if(!silent){toast(`Saved â€” ${noteTitle||"Untitled"}`);setSavePulse(true);setTimeout(()=>setSavePulse(false),600);}
      if(curChapter) loadNotes(curChapter.id);
    } catch(e){setAS("idle");toast(e.message,"error");}
  }
  function handleEditorInput() {
    setAS("saving");
    clearTimeout(autoSaveRef.current);
    autoSaveRef.current = setTimeout(()=>doSave(true),2500);
  }
  async function handleDelNote() {
    if(!curNid) return;
    const ok = await confirm(`Delete "${noteTitle||"Note"}"?\nCannot be undone.`);
    if(!ok) return;
    try {
      await API.deleteNote(curNid);
      clearEditor(); await loadNotes(curChapter.id);
      toast(`Deleted "${noteTitle||"Note"}"`,"error");
    } catch(e){toast(e.message,"error");}
  }

  // â”€â”€ Download â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function handlePDF() {
    downloadAsPDF(noteTitle||"Untitled", editorRef.current?.innerHTML||"", noteTags, curSubj?.name, curChapter?.name);
    toast("PDF ready â€” use print dialog to save ğŸ“„");
  }
  function handleWord() {
    downloadAsWord(noteTitle||"Untitled", editorRef.current?.innerHTML||"", noteTags, curSubj?.name, curChapter?.name);
    toast("Word file downloading ğŸ“");
  }

  // â”€â”€ Media â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function handleMediaAdd(file){setMediaFiles(p=>[...p,file]);toast(`${file.type==="image"?"ğŸ–¼ï¸":"ğŸ¬"} Added â€” click Insert â†‘`);}
  function handleMediaRemove(id){setMediaFiles(p=>p.filter(f=>f.id!==id));}
  function handleMediaInsert(file){
    if(!editorRef.current||!curNid) return;
    editorRef.current.focus();
    const tag = file.type==="image"
      ? `<img src="${file.src}" alt="${file.name}" style="max-width:100%;border-radius:8px;margin:8px 0;"/>`
      : `<video src="${file.src}" controls style="max-width:100%;border-radius:8px;margin:8px 0;"></video>`;
    document.execCommand("insertHTML",false,tag);
    handleEditorInput();
  }

  // â”€â”€ Auth â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function handleLogout() {
    try{await API.logout();}catch(_){}
    Auth.removeToken(); setCurrentUser(null);
  }

  // â”€â”€ Helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function fmt(cmd,val){if(!editorRef.current)return;editorRef.current.focus();document.execCommand(cmd,false,val||null);}
  function handleQuickNote(){setView("notes");setTimeout(handleAddNote,80);}

  const editorText = editorRef.current?.innerText||"";
  const words = editorText.trim() ? editorText.trim().split(/\s+/).length : 0;
  const chars = editorText.length;
  const filteredNotes = notes.filter(n=>{
    if(!search) return true;
    const q=search.toLowerCase();
    return (n.title||"").toLowerCase().includes(q)||(n.tags||"").toLowerCase().includes(q);
  });
  const totalNoteCount = subjects.reduce((a,s)=>a+(s.note_count||0),0);

  // â”€â”€ Render â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  if(!isAuthed) return <AuthScreen onAuth={u=>{setCurrentUser(u);}}/>;
  if(!splashDone) return <Splash onDone={()=>setSplashDone(true)}/>;

  return (
    <div className="app">
      {Dialog}
      <div className="toast-container">{toasts.map(t=>(<div key={t.id} className={`toast ${t.kind} ${t.exit?"exit":""}`}>{t.kind==="success"?"âœ…":t.kind==="error"?"âŒ":"âš ï¸"} {t.msg}</div>))}</div>
      {globalLoading && <div className="loading-overlay"><div className="spinner"/>Loadingâ€¦</div>}

      {/* â”€â”€ TOPBAR â”€â”€ */}
      <header className="topbar">
        <div className="topbar-logo" onClick={()=>setView("dashboard")}><Logo size={34}/><div className="logo-text-wrap"><span className="logo-title">NoteVault</span><span className="logo-sub">College Notes</span></div><span className="beta">v6</span></div>
        <div className="nav-tabs">
          <button className={`nav-tab ${view==="dashboard"?"active":""}`} onClick={()=>setView("dashboard")}>ğŸ  Dashboard</button>
          <button className={`nav-tab ${view==="notes"?"active":""}`} onClick={()=>setView("notes")}>ğŸ“ My Notes</button>
        </div>
        <div className="search-wrap">
          <span style={{color:"var(--sub)"}}>ğŸ”</span>
          <input placeholder="Search notesâ€¦" value={search} onChange={e=>setSearch(e.target.value)}/>
        </div>
        <div className="autosave-indicator">
          <div className={`autosave-dot ${autoSaveStatus}`}/>
          <span>{autoSaveStatus==="saving"?"Savingâ€¦":autoSaveStatus==="saved"?"Saved âœ“":"MongoDB"}</span>
        </div>
        <div className="topbar-right">
          <Clock/>
          <div className="stats-pill">{subjects.length}s Â· {totalNoteCount}n</div>
          <div className="user-pill"><div className="user-avatar">{(currentUser?.username||"U")[0].toUpperCase()}</div>{currentUser?.username||"User"}</div>
          <button className="theme-toggle" onClick={()=>setTheme(t=>t==="dark"?"light":"dark")}>{theme==="dark"?"ğŸŒ™":"â˜€ï¸"}<div className="toggle-track"><div className="toggle-thumb"/></div>{theme==="dark"?"Dark":"Light"}</button>
          <button className="btn-logout" onClick={handleLogout}>ğŸšª Logout</button>
        </div>
      </header>

      <div className="body">
        {/* â”€â”€ LEFT NAV â”€â”€ */}
        <div className="nav-sidebar">
          <button className={`nav-icon-btn ${view==="dashboard"?"active":""}`} onClick={()=>setView("dashboard")}>ğŸ <span className="tooltip">Dashboard</span></button>
          <button className={`nav-icon-btn ${view==="notes"?"active":""}`} onClick={()=>setView("notes")}>ğŸ“<span className="tooltip">My Notes</span></button>
          <div className="nav-divider"/>
          <button className="nav-icon-btn" onClick={()=>{loadSubjects();loadDash();toast("Refreshed from MongoDB âœ“");}}>ğŸ”„<span className="tooltip">Refresh</span></button>
        </div>

        {view==="dashboard" ? (
          <Dashboard stats={dashStats} onQuickNote={handleQuickNote}/>
        ) : (
          <div className="notes-app">
            {/* SUBJECTS */}
            <aside className="sidebar">
              <div className="sidebar-header">ğŸ“š Subjects</div>
              <div className="sidebar-section">
                <input placeholder="New subjectâ€¦" value={subjInput} onChange={e=>setSubjInput(e.target.value)} onKeyDown={handleAddSubj}/>
                <button className="btn-icon" onClick={handleAddSubj}>ï¼‹</button>
              </div>
              <div className="divider"/>
              <div className="subj-list">
                {subjects.length===0&&<div className="empty-hint">No subjects yet.<br/>Add one above! ğŸ‘†</div>}
                {subjects.map((subj,i)=>(
                  <div key={subj.id} className={`subj-item ${curSubj?.id===subj.id?"active":""}`} style={{animationDelay:`${i*40}ms`}}
                    onClick={()=>{setCurSubj(subj);setCurChapter(null);setCurNid(null);clearEditor();}}>
                    <div className="subj-dot" style={{background:COLORS[i%COLORS.length]}}/>
                    <div className="subj-item-inner">
                      <div className="subj-name">{ICONS[i%ICONS.length]} {subj.name}</div>
                      <div className="subj-count">{subj.chapter_count||0}ch Â· {subj.note_count||0}n</div>
                    </div>
                    <button className="subj-del" onClick={e=>{e.stopPropagation();handleDelSubj(subj);}}>âœ•</button>
                  </div>
                ))}
              </div>
              <div style={{padding:"4px 11px",background:"var(--panel)",borderTop:"1px solid var(--border)",fontSize:".62rem",color:"var(--success)",display:"flex",alignItems:"center",gap:5,flexShrink:0}}>
                <div style={{width:6,height:6,borderRadius:"50%",background:"var(--success)"}}/> MongoDB Atlas
              </div>
            </aside>

            {/* CHAPTERS */}
            <div className="chapter-panel">
              <div className="chapter-header">ğŸ“‘ Chapters</div>
              <div className="chapter-input-row">
                <input placeholder={curSubj?"New chapterâ€¦":"â† Pick subject"} value={chInput} onChange={e=>setChInput(e.target.value)} onKeyDown={handleAddChapter} disabled={!curSubj}/>
                <button className="btn-icon-sm" onClick={handleAddChapter} disabled={!curSubj}>ï¼‹</button>
              </div>
              <div className="divider"/>
              <div className="chapter-list">
                {!curSubj&&<div className="empty-hint">â† Select a subject</div>}
                {curSubj&&chapters.length===0&&<div className="empty-hint">No chapters yet.<br/>Add one above!</div>}
                {chapters.map((ch,i)=>(
                  <div key={ch.id} className={`chapter-item ${curChapter?.id===ch.id?"active":""}`} style={{animationDelay:`${i*35}ms`}}
                    onClick={()=>{setCurChapter(ch);setCurNid(null);clearEditor();}}>
                    <span className="chapter-icon">{CH_ICONS[i%CH_ICONS.length]}</span>
                    <div className="chapter-item-inner">
                      <div className="chapter-name">{ch.name}</div>
                      <div className="chapter-notes-count">{ch.note_count||0} notes</div>
                    </div>
                    <button className="chapter-del" onClick={e=>{e.stopPropagation();handleDelChapter(ch);}}>âœ•</button>
                  </div>
                ))}
              </div>
            </div>

            {/* NOTES LIST */}
            <div className="mid-panel">
              <div className="mid-header">
                <span className="mid-title">{curChapter?.name||"Notes"}</span>
                <button className="btn-new-note" onClick={handleAddNote} disabled={!curChapter}>ï¼‹ Note</button>
              </div>
              <div className="note-count">{filteredNotes.length} note{filteredNotes.length!==1?"s":""}</div>
              <div className="notes-list">
                {!curSubj&&<div className="empty-hint">â† Select a subject</div>}
                {curSubj&&!curChapter&&<div className="empty-hint">â† Select a chapter</div>}
                {curSubj&&curChapter&&filteredNotes.length===0&&<div className="empty-hint">{search?"No results.":"No notes yet.\nClick 'ï¼‹ Note'!"}</div>}
                {filteredNotes.map((note,idx)=>(
                  <div key={note.id} className={`note-card ${curNid===note.id?"active":""}`} style={{animationDelay:`${idx*35}ms`}} onClick={()=>loadNote(note.id,note)}>
                    <div className="note-card-title">{note.title||"Untitled"}</div>
                    {note.snippet&&<div className="note-card-snippet">{note.snippet}</div>}
                    <div className="note-card-footer">
                      <div className="note-tags">{(note.tags||"").split(",").filter(Boolean).slice(0,3).map(t=>(<span key={t} className="tag-chip">{t.trim()}</span>))}</div>
                      <span className="note-date">{note.modified||""}</span>
                    </div>
                  </div>
                ))}
              </div>
            </div>

            {/* EDITOR */}
            <div className="editor-panel">
              {(curSubj||curChapter||curNid)&&(
                <div className="breadcrumb">
                  <span className={`breadcrumb-item ${!curChapter&&!curNid?"active":""}`}>{curSubj?.name||"â€”"}</span>
                  {curSubj&&<><span className="breadcrumb-sep">â€º</span><span className={`breadcrumb-item ${!curNid?"active":""}`}>{curChapter?.name||"â€”"}</span></>}
                  {curChapter&&curNid&&<><span className="breadcrumb-sep">â€º</span><span className="breadcrumb-item active">{noteTitle||"New Note"}</span></>}
                </div>
              )}
              <div className="editor-toolbar">
                <div className="title-input-wrap"><input className="title-input" placeholder="Note titleâ€¦" value={noteTitle} onChange={e=>setNoteTitle(e.target.value)} disabled={!curNid}/></div>
                <div className="fmt-group">
                  <button className="fmt-btn" onClick={()=>fmt("bold")}><b>B</b></button>
                  <button className="fmt-btn" onClick={()=>fmt("italic")}><i>I</i></button>
                  <button className="fmt-btn" onClick={()=>fmt("underline")}><u>U</u></button>
                  <button className="fmt-btn highlight" onClick={()=>fmt("hiliteColor","#FFD166")}>â—ˆ HL</button>
                  <button className="fmt-btn bullet" onClick={()=>fmt("insertUnorderedList")}>â€¢ List</button>
                </div>
                <button className="btn-media" disabled={!curNid} onClick={()=>{
                  const inp=document.createElement("input");inp.type="file";inp.accept="image/*,video/*";inp.multiple=true;
                  inp.onchange=e=>[...e.target.files].forEach(f=>{const r=new FileReader();r.onload=ev=>handleMediaAdd({id:Date.now()+Math.random(),name:f.name,type:f.type.startsWith("image/")?"image":"video",src:ev.target.result});r.readAsDataURL(f);});
                  inp.click();
                }}>ğŸ–¼ï¸ Media</button>
                <button className={`btn-save ${savePulse?"pulse":""}`} onClick={()=>doSave(false)} disabled={!curNid}>ğŸ’¾ Save</button>
                <DownloadButton disabled={!curNid} onPDF={handlePDF} onWord={handleWord}/>
                <button className="btn-delete" onClick={handleDelNote} disabled={!curNid}>ğŸ—‘ Delete</button>
              </div>

              <div className="tag-bar">
                <span className="tag-bar-label">ğŸ· Tags:</span>
                <input className="tag-bar-input" placeholder="exam, chapter1, important" value={noteTags} onChange={e=>setNoteTags(e.target.value)} disabled={!curNid}/>
                {curNid&&<><span className="wcount">{words}w Â· {chars}c</span><span className={`last-saved ${showLS?"show":""}`}>âœ“ {lastSaved}</span></>}
              </div>

              {!curNid ? (
                <div className="welcome">
                  <Logo size={58}/>
                  <h2>Welcome to NoteVault</h2>
                  <p>Your notes are now stored in <strong>MongoDB Atlas</strong> â€” accessible from anywhere!</p>
                  <div className="welcome-path">
                    <span className="welcome-path-step">ğŸ“š Subject</span><span className="welcome-path-arrow">â†’</span>
                    <span className="welcome-path-step">ğŸ“‘ Chapter</span><span className="welcome-path-arrow">â†’</span>
                    <span className="welcome-path-step">ğŸ“ Note</span>
                  </div>
                  <div style={{background:"rgba(6,214,160,.1)",border:"1px solid rgba(6,214,160,.3)",borderRadius:10,padding:"10px 18px",fontSize:".78rem",color:"var(--success)",marginTop:8}}>
                    âœ… Connected to MongoDB Atlas Â· Data saved to cloud
                  </div>
                  <div className="shortcuts">
                    {[["Ctrl+S","Save"],["Ctrl+N","New Note"],["Ctrl+B","Bold"],["Ctrl+I","Italic"]].map(([k,v])=>(<div key={k} className="shortcut-item"><span className="kbd">{k}</span>{v}</div>))}
                  </div>
                </div>
              ) : (
                <div ref={editorRef} className="editor-area"
                  contentEditable={curNid?"true":"false"}
                  data-placeholder="Start writing your notes hereâ€¦ Use ğŸ–¼ï¸ Media to embed images & videos!"
                  suppressContentEditableWarning spellCheck
                  onInput={handleEditorInput}/>
              )}

              {/* Media strip */}
              {curNid && mediaFiles.length>0 && (
                <div className="media-strip">
                  {mediaFiles.map(m=>(
                    <div key={m.id} className="media-thumb" title={m.name}>
                      {m.type==="image"?<img src={m.src} alt={m.name} onClick={()=>handleMediaInsert(m)}/>:<video src={m.src} onClick={()=>handleMediaInsert(m)}/>}
                      <span className="media-thumb-type">{m.type==="image"?"IMG":"VID"}</span>
                      <button className="media-thumb-del" onClick={()=>handleMediaRemove(m.id)}>âœ•</button>
                      <button className="media-insert-btn" onClick={()=>handleMediaInsert(m)}>Insert â†‘</button>
                    </div>
                  ))}
                </div>
              )}

              <div className="statusbar">
                <span className={statusKind}>{status}</span>
                <span>â˜ï¸ MongoDB Atlas Â· Auto-saves every 2.5s</span>
              </div>
            </div>
          </div>
        )}
      </div>
    </div>
  );
}

ReactDOM.createRoot(document.getElementById("root")).render(<App/>);
</script>
</body>
</html>
